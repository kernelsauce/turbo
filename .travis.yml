language: erlang

env:
  matrix:
    - LUA=luajit20 LUA_DEV=libluajit-5.1-dev LUA_VER=5.1 LUA_SFX=jit LUA_INCDIR=/usr/local/include/luajit-2.1
    - LUA=luajit21 LUA_DEV=libluajit-5.1-dev LUA_VER=5.1 LUA_SFX=jit LUA_INCDIR=/usr/local/include/luajit-2.1

before_install:
  - if [ $LUA = "luajit20" ]; then
      git clone http://luajit.org/git/luajit-2.0.git && cd luajit-2.0 && sudo make install && sudo ln -sf luajit-2.0.3 /usr/local/bin/luajit && cd ..
    fi
  - if [ $LUA = "luajit21" ]; then
      git clone http://luajit.org/git/luajit-2.0.git && cd luajit-2.0 && git checkout v2.1 && sudo make install && sudo ln -sf luajit-2.1.0-alpha /usr/local/bin/luajit && cd ..
    fi
  - luajit -v
  - git clone https://github.com/keplerproject/luarocks.git
  - cd luarocks
  - ./configure --lua-version=$LUA_VER --lua-suffix=$LUA_SFX --with-lua-include="$LUA_INCDIR"
  - sudo make
  - sudo make install
  - cd $TRAVIS_BUILD_DIR

install:
  - sudo luarocks install luafilesystem
  - sudo luarocks install busted
  - sudo make install

script:
  - make test

notifications:
  email:
    on_success: change
    on_failure: always
